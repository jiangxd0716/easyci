<p>jenkins发布java项目</p>
<p>过程参考发布vue项目。<a href="https://www.cnblogs.com/jxd283465/p/11543431.html">https://www.cnblogs.com/jxd283465/p/11543431.html</a>&nbsp;大同小异。</p>
<p>vue建立的是Freestyle project，构建环境选择node</p>
<p>java建立的是maven project，构建环境使用maven</p>
<p>&nbsp;</p>
<p>1。配置全局工具中maven</p>
<p>maven及maven私服安装参考：<a href="https://www.cnblogs.com/jxd283465/p/11548593.html">https://www.cnblogs.com/jxd283465/p/11548593.html</a></p>
<p>配置maven的配置文件</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920101721018-122364338.png" alt="" width="795" height="160" /></p>
<p>配置jdk安装路径</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920102045080-1520244132.png" alt="" width="856" height="173" /></p>
<p>&nbsp;配置maven安装路径</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920102127739-347881184.png" alt="" width="909" height="217" /></p>
<p>2。新建maven项目</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920100307199-1147844753.png" alt="" width="547" height="521" /></p>
<p>&nbsp;3。配置项目描述、git参数</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920100435363-1199830659.png" alt="" width="922" height="315" /></p>
<p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920100455221-1662616349.png" alt="" width="915" height="291" /></p>
<p>&nbsp;4。配置源码管理git</p>
<p>&nbsp;如果使用sonar插件一定要配置Name</p>
<p>&nbsp;Branch Specifier为上方参数化构建的name，$表示调用参数</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920100743149-1088186080.png" alt="" width="993" height="353" /></p>
<p>&nbsp;5。配置触发器</p>
<p>当提交代码到gitlab时，自动触发jenkins自动发布</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920100942357-856173756.png" alt="" width="984" height="452" /></p>
<p>gitlab webhook配置</p>
<p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920101120669-934693712.png" alt="" width="996" height="504" /></p>
<p>&nbsp;6。配置构建环境</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920101331635-1572674357.png" alt="" width="1306" height="188" /></p>
<p>&nbsp;7。配置启动shell</p>
<p>勾选 &ldquo;Run only if build succeeds&rdquo;，当项目构建成功执行shell</p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920102229589-956515636.png" alt="" width="816" height="361" /></p>
<p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920102658543-906838751.png" alt="" width="945" height="221" /></p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">cd /home/jenkins/.jenkins/workspace/MingByteSiteApi
bash /home/jenkins/jenkins.sh 192.168.8.10:5000/mingbytesiteapi MingByteSiteApi
mvn package  -DskipTests 

mvn dockerfile:build
echo '================开始推送镜像================'
sudo docker push 192.168.8.10:5000/mingbytesiteapi:latest #推送镜像，镜像文件已经在前面的mvn步骤打好了
echo '================结束推送镜像================'

sudo docker run -d --name MingByteSiteApi -p:8089:8089 192.168.8.10:5000/mingbytesiteapi
echo "finished!" </span></pre>
</div>
<p>&nbsp;jenkins.sh</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">t=`sudo docker ps | grep $1|awk '{print  $1}'|sed 's/%//g'`;
b=``;
if [ $t ];
then
sudo docker stop  $t
echo "停止容器成功"
sudo docker rm $t
echo "删除容器成功"
else
echo "首次部署";
fi

tagnum=`git tag | wc -l`;
tag=(`git tag`)
a=0;
echo $tagnum
until [ $tagnum -lt 3 ]
do
   echo $a 删除tag：${tag[$a]}
   git tag -d ${tag[$a]}
   git push $2 :refs/tags/${tag[$a]}
   a=`expr $a + 1`
   tagnum=`expr $tagnum - 1`
done</span></pre>
</div>
<p>8。集成sonar代码审查</p>
<p>整合sonar代码审查参考：<a href="https://www.cnblogs.com/jxd283465/p/11548590.html">https://www.cnblogs.com/jxd283465/p/11548590.html</a></p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920102836249-2071722359.png" alt="" /></p>
<p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920102856091-2051287574.png" alt="" width="891" height="277" /></p>
<p>&nbsp;9。整合tag打包备份、整合邮件提醒</p>
<p>整合tag备份参考：<a href="https://www.cnblogs.com/jxd283465/p/11548589.html">https://www.cnblogs.com/jxd283465/p/11548589.html</a></p>
<p>整合邮件提醒参考：<a href="https://www.cnblogs.com/jxd283465/p/11548580.html">https://www.cnblogs.com/jxd283465/p/11548580.html</a></p>
<p><img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920103053275-980449078.png" alt="" width="361" height="684" /></p>
<p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920103221275-273438034.png" alt="" width="942" height="516" /></p>
<p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920103329277-539735041.png" alt="" width="1038" height="545" /></p>
<p>&nbsp;</p>
<p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1335688/201909/1335688-20190920103441406-655356564.png" alt="" width="1025" height="546" /></p>
<p>&nbsp;</p>